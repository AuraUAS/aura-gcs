<html>
  <head>
    <title>Aura Map</title>
    <link rel="stylesheet" href="leaflet/leaflet.css">
    <link rel="stylesheet" href="leaflet/plugins/leaflet.contextmenu.css">
    <link rel="stylesheet" href="leaflet/plugins/leaflet.draw.css">
    <link rel="stylesheet" href="map.css">
    <link rel="stylesheet" href="../modal.css">
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="leaflet/leaflet.js"></script>
    
    <script src="../js/jquery-3.2.1.js"></script>
    <link rel="stylesheet" href="../js/jquery-ui-1.12.1/jquery-ui.css">
    <link rel="stylesheet" href="../js/jquery-ui-1.12.1/jquery-ui.theme.css">
    <script src="../js/jquery-ui-1.12.1/jquery-ui.js"></script>
    
    <script src="leaflet/plugins/leaflet.contextmenu.js"></script>
    <script src="leaflet/plugins/leaflet-bing-layer.js"></script>
    
    <script src="leaflet/plugins/Leaflet.draw.js"></script>
    <script src="leaflet/plugins/Leaflet.Draw.Event.js"></script>
    <script src="leaflet/plugins/Control.Draw.js"></script>
    <script src="leaflet/plugins/Leaflet.draw.js"></script>
    <script src="leaflet/plugins/Leaflet.Draw.Event.js"></script>

    <script src="leaflet/plugins/edit/handler/Edit.Poly.js"></script>
    <script src="leaflet/plugins/edit/handler/Edit.SimpleShape.js"></script>
    <script src="leaflet/plugins/edit/handler/Edit.Rectangle.js"></script>
    <script src="leaflet/plugins/edit/handler/Edit.Marker.js"></script>
    <script src="leaflet/plugins/edit/handler/Edit.CircleMarker.js"></script>
    <script src="leaflet/plugins/edit/handler/Edit.Circle.js"></script>

    <script src="leaflet/plugins/draw/handler/Draw.Feature.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.Polyline.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.Polygon.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.SimpleShape.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.Rectangle.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.Circle.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.Marker.js"></script>
    <script src="leaflet/plugins/draw/handler/Draw.CircleMarker.js"></script>

    <script src="leaflet/plugins/ext/TouchEvents.js"></script>
    <script src="leaflet/plugins/ext/LatLngUtil.js"></script>
    <script src="leaflet/plugins/ext/GeometryUtil.js"></script>
    <script src="leaflet/plugins/ext/LineUtil.Intersect.js"></script>
    <script src="leaflet/plugins/ext/Polyline.Intersect.js"></script>
    <script src="leaflet/plugins/ext/Polygon.Intersect.js"></script>

    <script src="leaflet/plugins/Control.Draw.js"></script>
    <script src="leaflet/plugins/Tooltip.js"></script>
    <script src="leaflet/plugins/Toolbar.js"></script>

    <script src="leaflet/plugins/draw/DrawToolbar.js"></script>
    <script src="leaflet/plugins/edit/EditToolbar.js"></script>
    <script src="leaflet/plugins/edit/handler/EditToolbar.Edit.js"></script>
    <script src="leaflet/plugins/edit/handler/EditToolbar.Delete.js"></script>

    <script src="../link.js"></script>
    <link rel="stylesheet" href="../annunciator.css">
    <script src="../annunciator.js"></script>
    <script src="aircraft.js"></script>
    <script src="map.js"></script>
  </head>
  <body>
    <div id="mapid" style="width:100%; height:100%;"></div>
    <div id="annunciator_container">
      <div id="annunciator" class="control_box">
        <div id="sats" class="off">
          <div id="inner">0 sats</div>
        </div>
        <div id="ekf" class="off">
          <div id="inner">EKF</div>
        </div>
        <div id="volts" class="off">
          <div id="inner">0v</div>
        </div>
        <div id="battery" class="off">
          <div id="inner">0% batt</div>
        </div>
        <div id="timer" class="off">
          <div id="inner">0:00:00</div>
        </div>
        <div id="link" class="error">
          <div id="inner">Lost Link</div>
        </div>
        <div id="auto" class="off">
          <div id="inner">Manual</div>
        </div>
        <div id="wind" class="off">
          <div id="inner">000@0kt</div>
        </div>
        <div id="temp" class="off">
          <div id="inner">15C</div>
        </div>
        <div id="callsign" class="off">
          <div id="inner">callsign</div>
        </div>
      </div>
    </div>

    <script>
      $('#dialog-form').hide();
    </script>
    
    <!-- circle form -->
    <div id="circle-form" class="modal">
      <div class="modal-content">
        <span id="circle-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Circle Here:</h2>
            <p>
              Direction:
              <input type="radio" required="" name="circle-dir" id="circle-dir-left" value="Left" checked>
              <label for="circle-dir-left">Left</label>
              <input type="radio" required="" name="circle-dir" id="circle-dir-right" value="Right">
              <label for="circle-dir-right">Right</label>
            </p>
            <p>
              <label for="circle-radius">Radius (m)</label>
              <input type="text" name="radius" id="circle-radius" value="100">
            </p>
            <p>
              <button type="button" id="circle-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <!-- move home form -->
    <div id="home-form" class="modal">
      <div class="modal-content">
        <span id="home-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Position Home Here:</h2>
            <p>
              The home azimuth sets the orientation of 'pattern' style
              routes. It is fine to leave as zero.
            </p>
            <p>
              <label for="home-az">Azimuth (0-359 deg)</label>
              <input type="text" name="azimuth" id="home-azimuth" value="0">
            </p>
            <p>
              <button type="button" id="home-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <!-- calibration form -->
    <div id="calibrate-form" class="modal">
      <div class="modal-content">
        <span id="calibrate-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Calibrate Aircraft:</h2>
            <ul>
              <li>Sets home location to current aircraft location.</li>
              <li>Zeros airspeed.</li>
              <li>(Future: surveys ground altitude).</li>
            </ul>
            <p>Shield the pitot tube, click submit, then wait 10 seconds.</p>
            <p>Note: this command has no effect when airborne.</p>
            <p>
              <button type="button" id="calibrate-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- preflight form -->
    <div id="preflight-form" class="modal">
      <div class="modal-content">
        <span id="preflight-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Test Autopilot:</h2>
            <p>
              This command enables the pitch and roll controllers for
              the autopilot.  The aircraft aileron and elevator should
              respond appropriately to aircraft movement.
            </p>
            <p>Note: this command has no effect when airborne.</p>
            <p>
              <label for="preflight-duration">Duration (seconds)</label>
              <input type="text" name="duration" id="preflight-duration" value="60">
            </p>
            <p>
              <button type="button" id="preflight-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <!-- land form -->
    <div id="land-form" class="modal">
      <div class="modal-content">
        <span id="land-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Approach and Land:</h2>
            <p>
              Setup the approach and flare parameters for touchdown at
              the 'HOME' location. Expect 10-15 seconds for this
              command and all it's parameters to be sent up to the
              aircraft.
            </p>
            <p>
              <fieldset>
                <legend>Initial Descent Circle</legend>
                <div>
                  Direction:
                  <input type="radio" required="" name="land-dir" id="land-dir-left" value="Left" checked>
                  <label for="land-dir-left">Left</label>
                  <input type="radio" required="" name="land-dir" id="land-dir-right" value="Right">
                  <label for="land-dir-right">Right</label>
                </div>
                <div>
                  <label for="land-radius">Radius (m):</label>
                  <input type="text" name="radius" id="land-radius" value="75">
                </div>
              </fieldset>
            </p>
            <p>
              <fieldset>
                <legend>Approach</legend>
                <div>
                  <label for="land-runway-hdg">Runway Heading (deg):</label>
                  <input type="text" name="runway-hdg" id="land-runway-hdg" value="0">
                </div>
                <div>
                  <label for="land-glideslope">Glide Slope (deg):</label>
                  <input type="text" name="glideslope" id="land-glideslope" value="7">
                </div>
                <div>
                  <label for="land-airspeed">Approach Speed (kt):</label>
                  <input type="text" name="airspeed" id="land-airspeed" value="20">
                </div>
                <div>
                  <label for="land-extend">Extend Final Leg (m):</label>
                  <input type="text" name="extend" id="land-extend" value="100">
                </div>
              </fieldset>
            </p>
            <p>
              <fieldset>
                <legend>Flare</legend>
                <div>
                  <label for="land-flare-pitch">Pitch To (deg):</label>
                  <input type="text" name="flare-pitch" id="land-flare-pitch" value="0">
                </div>
                <div>
                  <label for="land-flare-sec">Lead Time (sec):</label>
                  <input type="text" name="flare-sec" id="land-flare-sec" value="5">
                </div>
              </fieldset>
            </p>
            <p>
              <fieldset>
                <legend>Position Adjustments</legend>
                <div>
                  <label for="land-lat-offset">Lateral Offset (m):</label>
                  <input type="text" name="flare-lat" id="land-lat-offset" value="0">
                </div>
                <div>
                  <label for="land-alt-bias">Altitude Bias (ft):</label>
                  <input type="text" name="alt-bias" id="land-alt-bias" value="0">
                </div>
              </fieldset>
            </p>
            <p>
              <button type="button" id="land-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <!-- set airspeed form -->
    <div id="airspeed-form" class="modal">
      <div class="modal-content">
        <span id="airspeed-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Set Target Airspeed:</h2>
            <p>
              <label for="airspeed-target">Target Airspeed (kts):</label>
              <label id="airspeed-target"></label>
            </p>
            <div id="slidecontainer">
              <input type="range" min="15" max="50" value="25" class="slider" id="airspeed-slider">
            </div>
            <p>
              <button type="button" id="airspeed-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <!-- set altitude form -->
    <div id="altitude-form" class="modal">
      <div class="modal-content">
        <span id="altitude-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Set Target Altitude:</h2>
            <p>
              <label for="altitude-target">Target Altitude AGL (ft):</label>
              <label id="altitude-target"></label>
            </p>
            <div id="slidecontainer">
              <input type="range" min="25" max="400" value="200" step="25" class="slider" id="altitude-slider">
            </div>
            <p>
              <button type="button" id="altitude-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <!-- map settings form -->
    <div id="settings-form" class="modal">
      <div class="modal-content">
        <span id="settings-close" class="close">&times;</span>
        <form>
          <div>
            <h2>Settings:</h2>
            <p>
              <fieldset>
                <legend>Map</legend>
                <div>
                  <label for="settings-autopan">Map follows aircraft:</label>
                  <input type="checkbox" name="follow" id="settings-autopan" value="autopan" checked>Autopan
                </div>
                <div>
                  <label for="settings-maxalt">Maximum Altitude AGL (ft):</label>
                  <input type="text" name="maxalt" id="settings-maxalt" value="400">
                </div>
                <div style="margin-left: 40px">
                  <em>Note: The FAA Part 107 rules set the maximum
                  ceiling to 400' AGL or 400' above a structure you
                  are inspecting.  It is crucial to understand and
                  honor the FAA airspace classes for your operational
                  area.</em>
                </div>
                <div>
                  <label for="settings-track-sec">Flight Track Length (sec):</label>
                  <input type="text" name="track-sec" id="settings-track-sec" value="600">
                </div>
              </fieldset>
            </p>
            <p>
              <button type="button" id="settings-form-submit" style="font-size:110%; padding: 5px 20px;">Submit</button>
            </p>
          </div>
        </form>
      </div>
    </div>
    
  </body>
</html>

<script>
  $('#dialog-form').hide();
  map_init();
  annunciator.init();
</script>
